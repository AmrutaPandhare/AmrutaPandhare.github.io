<!DOCTYPE html>
<!-- _layouts/distill.html --><html>
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    <!-- Metadata, OpenGraph and Schema.org -->
    

    <!-- Standard metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Tenable | Amruta Pandhare  </title>
    <meta name="author" content="Amruta Pandhare  ">
    <meta name="description" content="Automating Tenable Scan Downloads and Conversions to CSV and JSON with Python">
    <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website">


    <!-- Bootstrap & MDB -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous">

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

    <!-- Code Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light">

    <!-- Styles -->
    
    <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%92%AB&lt;/text&gt;&lt;/svg&gt;">
    
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="canonical" href="https://amrutapandhare.github.io/blog/2023/tenableAPI/">
    
    <!-- Dark Mode -->
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark">

    <script src="/assets/js/theme.js"></script>
    <script src="/assets/js/dark_mode.js"></script>
    


    <!-- jQuery -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <!-- MathJax -->
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        tags: 'ams'
      }
    };
  </script>
  <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
  <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

    <!-- Distill js -->
    <script src="/assets/js/distillpub/template.v2.js"></script>
    <script src="/assets/js/distillpub/transforms.v2.js"></script>
    <script src="/assets/js/distillpub/overrides.js"></script>
    
  </head>

  <body>
<d-front-matter>
    <script async type="text/json">{
      "title": "Tenable",
      "description": "Automating Tenable Scan Downloads and Conversions to CSV and JSON with Python",
      "published": "April 1, 2023",
      "authors": [
        {
          "author": "Amruta Pandhare",
          "authorURL": "",
          "affiliations": [
            {
              "name": "Tenable",
              "url": ""
            }
          ]
        }
        
      ],
      "katex": {
        "delimiters": [
          {
            "left": "$",
            "right": "$",
            "display": false
          },
          {
            "left": "$$",
            "right": "$$",
            "display": true
          }
        ]
      }
    }</script>
  </d-front-matter>

  

    <!-- Header -->
    <header>

      <!-- Nav Bar -->
      <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
        <div class="container">
          <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Amruta Pandhare </span></a>
          <!-- Navbar Toggle -->
          <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar top-bar"></span>
            <span class="icon-bar middle-bar"></span>
            <span class="icon-bar bottom-bar"></span>
          </button>

          <div class="collapse navbar-collapse text-right" id="navbarNav">
            <ul class="navbar-nav ml-auto flex-nowrap">

              <!-- About -->
              <li class="nav-item ">
                <a class="nav-link" href="/">About Me</a>
              </li>
              
              <!-- Blog -->
              <li class="nav-item active">
                <a class="nav-link" href="/blog/">Blogs<span class="sr-only">(current)</span></a>
              </li>

              <!-- Other pages -->
              <li class="nav-item ">
                <a class="nav-link" href="/activities/">Activities</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/resume/">Resume</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/certifications/">Certifications</a>
              </li>

              <!-- Toogle theme mode -->
              <li class="toggle-container">
                <button id="light-toggle" title="Change theme">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
                </button>
              </li>
            </ul>
          </div>
        </div>
      </nav>

      <!-- Scrolling Progress Bar -->
      <progress id="progress" value="0">
        <div class="progress-container">
          <span class="progress-bar"></span>
        </div>
      </progress>
    </header>


    <!-- Content -->
    <div class="post distill">

      <d-title>
        <h1>Tenable</h1>
        <p>Automating Tenable Scan Downloads and Conversions to CSV and JSON with Python</p>
      </d-title>

      <d-byline></d-byline>

      <d-article>
        <d-contents>
          <nav class="l-text figcaption">
          <h3>Contents</h3>
            <div><a href="#about">About</a></div>
            <div><a href="#overview">Overview</a></div>
            <div><a href="#script">Script</a></div>
            <div><a href="#additional-use-cases">Additional Use Cases</a></div>
            <div><a href="#conclusion">Conclusion</a></div>
            
          </nav>
        </d-contents>

        <h2 id="about">About</h2>

<p>Managing Tenable scans programmatically can save time and effort, especially when dealing with multiple scans. This blog will guide you through a Python script that leverages the Tenable API to download specific scans, save them in CSV format, and convert the CSV files to JSON. We’ll explain each part of the script so you can understand and modify it as needed.</p>

<hr>
<h2 id="overview">Overview</h2>

<p><strong>Script Overview</strong>
Before diving into the code, let’s outline the main steps the script performs:</p>

<p><strong>Configure logging and set API keys</strong>: Initialize logging and define your Tenable API keys.
<strong>Fetch scan data</strong>: Retrieve the list of scans from Tenable.io.
<strong>Download scans</strong>: Export the scans in CSV format.
<strong>Save and process scans</strong>: Save the CSV files and convert them to JSON format.</p>

<hr>
<h2 id="script">Script</h2>

<p>Here’s the full script with comments explaining each part:</p>

<p>python
Copy code
import requests
import json
import csv
import sys
import time
import pandas as pd
import logging
import re</p>

<p># Configure logging
logging.basicConfig(filename=’log.txt’, level=logging.INFO, format=’%(asctime)s:%(levelname)s:%(message)s’)</p>

<p># Set Tenable API keys
ACCESS_KEY = ‘YOUR_ACCESS_KEY’
SECRET_KEY = ‘YOUR_SECRET_KEY’
scan_search_list = [‘scan1’, ‘scan2’, ‘scan3’]</p>

<p># Set the base URL and headers for the Tenable API
url = ‘https://cloud.tenable.com’
headers = {‘X-ApiKeys’: f’accessKey={ACCESS_KEY}; secretKey={SECRET_KEY};’}</p>

<p>for scan_search in scan_search_list:
    logging.info(f”Processing scan search: {scan_search}”)</p>

<p># Fetching scans
    scans = requests.get(f’{url}/scans’, headers=headers).json()[‘scans’]
    for scan in scans:
        if scan_search.lower() in scan[‘name’].lower() and not scan[‘name’].endswith(‘_OLD’):
            scan_id = scan[‘id’]
            scan_name = scan[‘name’]
            uuid = scan.get(“uuid”, scan.get(“wizard_uuid”, “”))  # UUID or WIZARD_UUID
            logging.info(f’Found: {scan_name} ({scan_id})’)</p>

<p># Request download
            export_request = {
                ‘chapters’: ‘vuln_hosts_summary,vuln_by_host,compliance_exec,remediations,vuln_by_plugin,compliance’,
                ‘filter.search_type’: ‘and’,
                ‘format’: ‘csv’
            }
            file_request = requests.post(f’{url}/scans/{scan_id}/export’, headers=headers, json=export_request)
            if file_request.status_code != 200 or ‘error’ in file_request.json():
                logging.error(f’Request failed for {scan_name}: {file_request.text}’)
                continue  # Skip to the next scan</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        file_id = file_request.json()['file']
</code></pre></div></div>

<p># Monitor until not loading
            status = ‘loading’
            while status == ‘loading’:
                time.sleep(1)
                file_status = requests.get(f’{url}/scans/{scan_id}/export/{file_id}/status’, headers=headers).json()
                status = file_status[‘status’]
                logging.info(f’Checking status for {scan_name}: {status}’)</p>

<p># Download if ready
            if status == ‘ready’:
                file_download = requests.get(f’{url}/scans/{scan_id}/export/{file_id}/download’, headers=headers)
                filename = f’{scan_name.replace(“ “, “_”)}.csv’
                with open(filename, ‘wb’) as fout:
                    fout.write(file_download.content)
                logging.info(f’Wrote: {filename}’)</p>

<p># Convert CSV to JSON
                selected_columns = [‘Host Start’, ‘Risk’, ‘CVE’, ‘Host’, ‘Name’, ‘Solution’]
                df = pd.read_csv(filename, usecols=selected_columns)
                df.rename(columns={‘Host Start’: ‘scanStartDate’, ‘Risk’: ‘risk’, ‘CVE’: ‘cve’, ‘Host’: ‘host’, ‘Name’: ‘name’, ‘Solution’: ‘solution’}, inplace=True)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            record_date = df['scanStartDate'].iloc[0][:10]
            
            scan_entries = []
            for _, row in df.iterrows():
                entry = {
                    'scanStartDate': 'None' if pd.isna(row['scanStartDate']) else row['scanStartDate'],
                    'risk': 'None' if pd.isna(row['risk']) else row['risk'],
                    'cve': 'None' if pd.isna(row['cve']) else row['cve'],
                    'host': 'None' if pd.isna(row['host']) else row['host'],
                    'name': 'None' if pd.isna(row['name']) else row['name'],
                    'solution': 'None' if pd.isna(row['solution']) else row['solution']
                }
                scan_entries.append(entry)
            
            additional_info = {"recordDate": record_date, "scanEntries": scan_entries}
            final_json_data = json.dumps(additional_info) + '\n'

            json_filename = f'{scan_name}-{record_date}.json'
            with open(json_filename, 'w') as json_file:
                json_file.write(final_json_data)
            logging.info(f'Appended information to JSON: {json_filename}')
        else:
            logging.error(f'Issue with file for {scan_name}: {status}')
</code></pre></div></div>

<p>print(“Script execution completed.”)</p>

<hr>
<h2 id="additional-use-cases">Additional Use Cases</h2>

<p><strong>Automated Report Generation</strong>
Scheduled execution of the script to regularly download and process scans, generating periodic reports.
Email notifications to send generated reports or alerts based on scan results.</p>

<p><strong>Integration with SIEM Systems</strong>
Send JSON data to a Security Information and Event Management (SIEM) system for further analysis and correlation.
Webhook integration to trigger real-time actions based on scan results.</p>

<p><strong>Visualization and Dashboarding</strong>
Data visualization tools like Matplotlib or Seaborn to create visual reports from the scan data.
Integration with BI tools like Tableau or Power BI to create interactive dashboards.</p>

<p><strong>Advanced Filtering and Analysis</strong>
Custom filters to extract specific vulnerabilities or assets based on certain criteria.
Trend analysis to monitor vulnerability trends over time.</p>

<hr>
<h2 id="conclusion">Conclusion</h2>

<p>This script automates the process of downloading and processing Tenable scan data, making it easier to manage and analyze scan results. By following the detailed steps above, you can adapt the script to fit your specific needs and integrate it into your workflow. Happy coding!</p>

      </d-article>

      <d-appendix>
        <d-footnote-list></d-footnote-list>
        <d-citation-list></d-citation-list>
      </d-appendix>

      <d-bibliography src="/assets/bibliography/"></d-bibliography>
</div>

    <!-- Footer -->    
    <footer class="fixed-bottom">
      <div class="container mt-0">
        © Copyright 2024 Amruta Pandhare  . 
      </div>
    </footer>

    <!-- Bootsrap & MDB scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script>

    
    

<!-- Scrolling Progress Bar -->
<script type="text/javascript">
  /*
   * This JavaScript code has been adapted from the article 
   * https://css-tricks.com/reading-position-indicator/ authored by Pankaj Parashar, 
   * published on the website https://css-tricks.com on the 7th of May, 2014.
   * Couple of changes were made to the original code to make it compatible 
   * with the `al-foio` theme.
   */
  const progressBar = $("#progress");
  /*
   * We set up the bar after all elements are done loading.
   * In some cases, if the images in the page are larger than the intended
   * size they'll have on the page, they'll be resized via CSS to accomodate
   * the desired size. This mistake, however, breaks the computations as the
   * scroll size is computed as soon as the elements finish loading.
   * To account for this, a minimal delay was introduced before computing the
   * values.
   */
  window.onload = function () {
    setTimeout(progressBarSetup, 50);
  };
  /*
   * We set up the bar according to the browser.
   * If the browser supports the progress element we use that.
   * Otherwise, we resize the bar thru CSS styling
   */
  function progressBarSetup() {
    if ("max" in document.createElement("progress")) {
      initializeProgressElement();
      $(document).on("scroll", function() {
        progressBar.attr({ value: getCurrentScrollPosition() });
      });
      $(window).on("resize", initializeProgressElement);
    } else {
      resizeProgressBar();
      $(document).on("scroll", resizeProgressBar);
      $(window).on("resize", resizeProgressBar);
    }
  }
  /*
   * The vertical scroll position is the same as the number of pixels that
   * are hidden from view above the scrollable area. Thus, a value > 0 is
   * how much the user has scrolled from the top
   */
  function getCurrentScrollPosition() {
    return $(window).scrollTop();
  }

  function initializeProgressElement() {
    let navbarHeight = $("#navbar").outerHeight(true);
    $("body").css({ "padding-top": navbarHeight });
    $("progress-container").css({ "padding-top": navbarHeight });
    progressBar.css({ top: navbarHeight });
    progressBar.attr({
      max: getDistanceToScroll(),
      value: getCurrentScrollPosition(),
    });
  }
  /*
   * The offset between the html document height and the browser viewport
   * height will be greater than zero if vertical scroll is possible.
   * This is the distance the user can scroll
   */
  function getDistanceToScroll() {
    return $(document).height() - $(window).height();
  }

  function resizeProgressBar() {
    progressBar.css({ width: getWidthPercentage() + "%" });
  }
  // The scroll ratio equals the percentage to resize the bar
  function getWidthPercentage() {
    return (getCurrentScrollPosition() / getDistanceToScroll()) * 100;
  }
</script>

  
</body>
</html>
